---
title: WTF is up with Istio and eBPF?
---

::: {style="text-align: center"}
[![a service mesh and a programmable kernel walk into a bar ...](media/istio-and-ebpf.png "eBPF honey bee logo plus istio sailboat logo equals question mark."){width=80%}](http://source.com/)
:::

::: {.callout-tip appearance="simple" icon=false}
**tl;dr** - **Nothing**. Not a damned thing.
:::

### Why _would_ Istio use eBPF?

Istio uses iptables to transparently redirect traffic from an application container into a sidecar proxy container so it can do all the fancy service mesh stuff with that traffic, however the iptables redirection adds some (small but nonzero) latency overhead. At large scales that overhead adds up. To alleviate this overhead eBPF can be used to bypass much of the Linux network stack for a nice performance boost. In fact there is a CNCF project called [Merbridge](https://merbridge.io/) that does exactly that for Kuma, Linkerd, and Istio.


::: {#fix-datapath layout-ncol=2 style="text-align: center"}

![data path using iptables](media/merbridge_iptables_path.png "A diagram showing the path of data leaving a primary container, winding it's way up and down the Linux TCP/IP stack, before finally arriving at the Envoy sidecar.")

![data path using eBPF](media/merbridge_eBPF_path.png "A diagram show the path of data leaving a primary container and being immediately picked up by an eBPF program in the kernel and rerouted directly to an Envoy sidecar, bypassing much of the network stack.")

:::

::: {style="text-align: center"}

These images are from [the Merbridge docs](https://merbridge.io/docs/overview/), which are based on [these slides](https://www.slideshare.net/slideshow/accelerating-envoy-and-istio-with-cilium-and-the-linux-kernel/) from Isovalent CTO Thomas Graf's [2018 Kubecon talk](https://youtu.be/ER9eIXL2_14?t=745) "Accelerating Envoy with the Linux Kernel".

:::

### What about [this blog post](https://istio.io/latest/blog/2023/ambient-ebpf-redirection/)?

You mean that 2023 blog post that describes in detail how Istio's shiny new [ambient mode](https://istio.io/latest/docs/ambient/overview/) leverages eBPF and shows off some sweet performance gains?

::: {style="text-align: center"}

![QPS when you drink eBPF protein shakes](media/istio-ebpf/MaxQPS.png "A bar chart showing an appreciable boost to the number of queries per second Istio can process when using eBPF for traffic redirection."){width=80%}

:::

Surprise! [That's bullshit now](https://istio.io/latest/blog/2024/inpod-traffic-redirection-ambient/). It turned out to be very difficult to build this feature in a way that is compatible with every possible CNI plugin out there so the approach was abandoned.

### What about ... _the incident?_

You mean that time that experimenting with eBPF led to a minor dustup with the CNCF over licensing? Yeah that did happen but it turned out to be no big deal and actually ended up improving things with the use of eBPF in CNCF projects.

The issue occured due to the GPL's absence from the CNCF's [list of approved software licenses](https://github.com/cncf/foundation/blob/main/allowed-third-party-license-policy.md#approved-licenses-for-allowlist) and the [eBPF reference implementation's](https://docs.kernel.org/bpf/bpf_licensing.html) presence in the Linux kernel which is of course [GPL-2.0](https://www.kernel.org/doc/html/latest/process/license-rules.html) licensed. The upshot if this situation was that there was some uncertainty if projects leveraging eBPF would be accepted into the CNCF.

Oct 26 2022 Cilium applies for Graduation https://github.com/cncf/toc/pull/952 live at kubecon https://youtu.be/WxZr35Eyqxk?t=1963
Dec  5 2022 Kong wants to donate blixt to CNCF https://github.com/kubernetes/org/issues/3875
Dec  6 2022 MrBobbyTables asks for clarification https://github.com/cncf/foundation/issues/474
Mar  6 2023 MrBobbyTables points out the GPL conflict https://github.com/kubernetes/org/issues/3875#issuecomment-1456514371
Feb  1 2023 Istio applies for Graduation https://github.com/cncf/toc/pull/1000

Licensing post https://ebpf.io/blog/ebpf-licensing-guide/
Licensing talk https://www.youtube.com/watch?v=cxyDEdzNdH8
